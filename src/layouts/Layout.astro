---
import '../styles/global.css';

interface Props {
  title: string;
  lang: 'en' | 'tr';
}

const { title, lang } = Astro.props;
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Minimalist Book Reviews" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href={`${base}/favicon.svg`} />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body class="min-h-screen px-4 py-8 max-w-3xl mx-auto">
    <header class="mb-12">
      <div class="flex justify-between items-center">
        <nav class="flex gap-4">
          <a href={`${base}/en`} class={lang === 'en' ? 'font-bold underline' : 'opacity-60 hover:opacity-100'}>[EN]</a>
          <a href={`${base}/tr`} class={lang === 'tr' ? 'font-bold underline' : 'opacity-60 hover:opacity-100'}>[TR]</a>
        </nav>
        
        <button id="theme-toggle" class="cursor-pointer opacity-80 hover:opacity-100 text-xl" aria-label="Toggle theme">
          <span id="moon-icon" class="hidden">üåë</span>
          <span id="sun-icon" class="hidden">‚òÄÔ∏è</span>
        </button>
      </div>
      <div class="mb-6 pt-4">
        <h1 class="text-xl font-bold">{lang === 'en' ? "Utku's Reading Archive" : "Utku'nun Okuma Ar≈üivi"}</h1>
      </div>
    </header>
    
    <main>
      <slot />
    </main>

    <script>
      const themeToggle = document.getElementById('theme-toggle');
      const html = document.documentElement;

      const sunIcon = document.getElementById('sun-icon');
      const moonIcon = document.getElementById('moon-icon');

      function updateThemeUI(isDark) {
        if (isDark) {
          html.classList.add('dark');
          sunIcon?.classList.remove('hidden');
          moonIcon?.classList.add('hidden');
        } else {
          html.classList.remove('dark');
          sunIcon?.classList.add('hidden');
          moonIcon?.classList.remove('hidden');
        }
      }

      // Check local storage or system preference
      const savedTheme = localStorage.getItem('theme');
      const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const initialDark = savedTheme === 'dark' || (!savedTheme && systemDark);

      updateThemeUI(initialDark);

      themeToggle?.addEventListener('click', () => {
        const isDark = !html.classList.contains('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        updateThemeUI(isDark);
      });
    </script>
  </body>
</html>
